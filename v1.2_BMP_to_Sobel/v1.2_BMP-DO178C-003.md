# DO-178C BMP Image Processor Documentation Package

## DO-178C 문서화 패키지
**BMP 이미지 그레이스케일 변환 소프트웨어 / Verilog MEM Export / 소벨 엣지(BMP) 출력 추가 (v1.2)**

> 본 저장소는 24비트 컬러 BMP 이미지를 8비트 그레이스케일 BMP로 변환하고 동일 그레이스케일 데이터를 **Verilog `.mem`** 텍스트 파일로 내보내는 예제 소프트웨어와 **DO-178C DAL-D** 수준 문서 스냅샷을 제공한다.  
> **v1.2에서는 소벨(Sobel) 엣지 검출 기능을 추가하여 엣지 이미지를 별도 8비트 BMP로 저장**한다. MEM 출력은 Verilog 시뮬레이션/테스트벤치의 메모리 초기화(`$readmemh`) 용도로 사용한다.

---

<img width="360" height="360" alt="brainct_001" src="https://github.com/user-attachments/assets/64c461e8-e8b4-4c2b-9b7d-45248e8c6849" />

**BrainCT**

<img width="360" height="360" alt="brainct_grayscale_001" src="https://github.com/user-attachments/files/22039541/output_grayscale.bmp" />

**BrainCT_GrayScale**

<img width="360" height="360" alt="brainct_grayscale_001" src="https://github.com/user-attachments/files/22040156/output_edge.bmp" />

**BrainCT_Sobel**



### 문서 관리 정보
- 문서 ID: BMP-DO178C-003  
- 버전: **1.2 (2025년 8월 29일)**  
- 분류: 설계 보증 레벨 D (DAL-D)  
- 시스템: 디스플레이 처리 장치

#### 개정 요약 (v1.1)
- BMP 저장 이후 **그레이스케일 버퍼를 이용해 Verilog `.mem` 파일** 생성 기능 추가  
- 각 픽셀을 **2자리 대문자 16진수 + CRLF(`\r\n`)**로 기록, **상→하 / 좌→우** 순서  
- (권고) 개행 이식성 확보를 위해 MEM 파일 **`wb` 모드** 사용  
- **시뮬레이션 목적 명시**: 생성된 `.mem`은 **Verilog 시뮬레이션의 ROM/RAM 초기화 입력**으로 사용  
- 동일 입력 2회 실행 비교 결과:  
  ```bat
  C:\Users\44\Desktop>fc image_data1.mem image_data2.mem
  파일을 비교합니다: image_data1.mem - IMAGE_DATA2.MEM
  FC: 다른 점이 없습니다.

---

## 1. 소프트웨어 인증 계획서 (PSAC)

### 1.1 소프트웨어 개요
- **소프트웨어 항목**: BMP 그레이스케일 변환기  
- **기능**: 디스플레이 시스템용 24비트 컬러 BMP 이미지를 8비트 그레이스케일로 변환 **및 Verilog `.mem`로 내보내기(시뮬레이션 메모리 초기화)**  
- **중요도 레벨**: DAL-D (경미한 고장 상황)

### 1.2 소프트웨어 생명주기 프로세스
- 계획 수립 프로세스  
- 소프트웨어 개발 프로세스  
- 소프트웨어 검증 프로세스  
- 소프트웨어 형상관리 프로세스  
- 소프트웨어 품질보증 프로세스

### 1.3 소프트웨어 생명주기 데이터
**제출 문서**
- 소프트웨어 인증 계획서 (PSAC)  
- 소프트웨어 요구사항 표준 (SRS)  
- 소프트웨어 설계 표준 (SDS)  
- 소프트웨어 코드 표준 (SCS)  
- 소프트웨어 검증 계획 (SVP)  
- 소프트웨어 형상관리 계획 (SCMP)

---

## 2. 소프트웨어 요구사항 표준 (SRS)

### 2.1 상위레벨 요구사항
- **HLR-001: 이미지 형식 검증**
  - 입력 파일이 **24비트 BMP 형식**임을 검증해야 한다.  
  - 이미지 크기가 **630×630** 픽셀임을 확인해야 한다.  
  - 유효하지 않은 파일 형식은 **명확한 오류 메시지**와 함께 거부해야 한다.

- **HLR-002: 색공간 변환**
  - 표준 휘도 공식 사용: `Y = 0.299R + 0.587G + 0.114B`  
  - 변환 중 **픽셀의 공간적 관계 유지**  
  - 출력 값은 **0–255** 범위

- **HLR-003: 출력 파일 생성 (BMP)**
  - **8비트 그레이스케일 BMP** 생성  
  - **256색 그레이스케일 팔레트** 포함  
  - BMP **표준 준수**

- **HLR-004: 메모리 관리**
  - 동적 메모리 **할당 실패 감지/처리**  
  - **모든 메모리 적절히 해제**, 누수 금지

- **HLR-005: 오류 처리**
  - **파일 I/O 오류** 감지 및 보고  
  - 비정상 종료 시 **리소스 정리**  
  - 모든 오류에 **명확한 메시지**

- **HLR-006: 출력 파일 생성 (Verilog MEM) – v1.1 추가**
  - 변환된 그레이스케일 데이터를 **Verilog `.mem` 텍스트 파일**로 생성해야 한다.  
  - 각 픽셀은 **2자리 대문자 16진수**, 줄 구분자는 **CRLF(0x0D 0x0A)**.  
  - 기록 순서는 **상→하 / 좌→우**.  
  - **목적**: Verilog 시뮬레이션에서 **`$readmemh`로 메모리 초기화**에 사용 가능해야 한다.  
  - 파일 생성 실패 시 **오류 메시지 출력** 및 **리소스 정리**.

### 2.2 저수준 요구사항
- **LLR-001: BMP 헤더 검증**
  - 파일 시그니처 **0x4D42 ("BM")** 확인  
  - `bitCount == 24` 검증  
  - `width == 630`, `height == 630` 검증

- **LLR-002: 픽셀 데이터 읽기**
  - BMP 픽셀 데이터 **하단→상단** 순으로 읽기  
  - 각 행의 **패딩 바이트 처리**  
  - `RGB` 구조체로 저장

- **LLR-003: 그레이스케일 변환 알고리즘**
  - 각 픽셀에 공식 `Y = 0.299R + 0.587G + 0.114B` 적용  
  - 결과를 `uint8_t`로 캐스팅  
  - 별도 배열에 저장

- **LLR-004: 출력 BMP 생성**
  - **8비트 BMP**용 헤더 생성  
  - **256색 그레이스케일 팔레트** 작성  
  - 그레이스케일 데이터를 **하단→상단** 순으로 출력

- **LLR-005: Verilog MEM 생성 – v1.1 추가**
  - 기본 파일명: `output_image.mem`  
  - (권고) 파일 열기 모드: **`wb`**  
  - 버퍼 순서(**상→하 / 좌→우**) 그대로 순회하며 `fprintf("%02X\r\n", value)`로 기록  
  - 시뮬레이션 적합성:  
    ```verilog
    $readmemh("output_image.mem", mem);
    ```  
  - 기록 완료 후 파일 닫기 및 완료 메시지 출력

---

## 3. 소프트웨어 설계 표준 (SDS)

### 3.1 아키텍처 설계
**모듈 구조**

~~~
BMP__Processor
├─── File_Handler
│  ├─── Input_Validator
│  └─── Output_Generator
│      ├─── BMP_Writer
│      └─── MEM_Exporter     (v1.1, Verilog 시뮬레이션 입력)
├─── Image_Processor
│  ├─── Color__Converter
│  └─── Memory__Manager
└─── Error_Handler
~~~


### 3.2 상세 설계
**구조체 정의**
- `BMPFileHeader`: BMP 파일 헤더 정보  
- `BMPInfoHeader`: BMP 정보 헤더  
- `RGB`: 24비트 RGB 픽셀 데이터

**주요 함수**
- `main()` : 메인 프로세스 제어  
- `rgbToGrayscale()` : RGB→그레이스케일 변환  
- 파일 I/O 처리 루틴  
- 메모리 할당/해제 루틴

### 3.3 인터페이스 설계
**입력 인터페이스**
- 파일명: `brainct_001.bmp`  
- 형식: 24비트 컬러 BMP  
- 크기: **630×630** 픽셀

**출력 인터페이스**
- 파일명: `output_grayscale.bmp`  
  - 형식: **8비트 그레이스케일 BMP**  
  - 팔레트: **256색**  
- **(v1.1)** 파일명: `output_image.mem`  
  - 형식: 텍스트(행당 1바이트)  
  - 각 행: **2자리 대문자 16진수 + CRLF**  
  - 순서: **상→하 / 좌→우**  
  - **사용처**: Verilog **`$readmemh`** 초기화 입력

---

## 4. 소프트웨어 코드 표준 (SCS)

### 4.1 코딩 규칙
**명명 규칙**
- 구조체: PascalCase (예: `BMPFileHeader`)  
- 함수: camelCase (예: `rgbToGrayscale`)  
- 변수: camelCase (예: `imageData`)  
- 상수: UPPER_CASE (예: `IMAGE_WIDTH`)

**코드 스타일**
- 들여쓰기: **4칸 스페이스**  
- 중괄호: **K&R 스타일**  
- 한 줄당 **하나의 명령문**  
- **적절한 주석** 작성

### 4.2 품질 기준
**가독성**
- 명확한 변수명  
- 적절한 주석  
- 일관된 형식

**유지보수성**
- 모듈화  
- 오류 처리 포함  
- 메모리 관리 규칙 준수

### 4.3 (v1.1) 파일 모드 표준
- CRLF를 명시적으로 기록하는 텍스트 파일은 **`wb` 모드 사용 권고** (개행 이식성 확보)

---

## 5. 소프트웨어 검증 계획 (SVP)

### 5.1 검증 목표
- 모든 요구사항이 올바르게 구현되었는지 확인  
- 항공 안전 기준 충족 검증  
- 오류 조건 동작 검증

### 5.2 검증 방법
**정적 분석**
- 코드 리뷰  
- MISRA C 규칙 준수 검사  
- 정적 분석 도구 사용

**동적 테스트**
- 단위 테스트  
- 통합 테스트  
- 시스템 테스트

### 5.3 테스트 케이스
- **TC-001: 정상 입력 처리**  
  - 유효한 630×630 24bpp BMP 입력  
  - 예상: 성공적 그레이스케일 변환/출력

- **TC-002: 잘못된 파일 형식**  
  - 비-BMP 입력  
  - 예상: 오류 메시지 출력, 프로그램 종료

- **TC-003: 잘못된 이미지 크기**  
  - 630×630이 아닌 BMP 입력  
  - 예상: 크기 오류 메시지

- **TC-004: 메모리 부족 상황**  
  - 메모리 할당 실패 시뮬레이션  
  - 예상: 적절한 오류 처리 및 정리

- **TC-005: 파일 I/O 오류**  
  - 읽기/쓰기 권한 없는 파일  
  - 예상: I/O 오류 메시지

- **(v1.1) TC-006: MEM 파일 생성 정상 흐름**  
  - 조건: 유효한 630×630 24bpp BMP  
  - 절차: 변환 수행 → `output_image.mem` 생성 확인  
  - 기대: 파일 존재, 행 수 = **630×630**, 각 행 **2자리 16진수 + CRLF**

- **(v1.1) TC-007: MEM 동일성 비교 (재현성)**  
  - 조건: 동일 입력으로 2회 변환 → `image_data1.mem`, `image_data2.mem`  
  - 명령:
    ```bat
    C:\Users\44\Desktop>fc image_data1.mem image_data2.mem
    파일을 비교합니다: image_data1.mem - IMAGE_DATA2.MEM
    FC: 다른 점이 없습니다.
    ```
  - 관찰 결과: **동일** → 결정적 출력 확인

### 5.4 커버리지 기준
- **명령문 커버리지**: 100%  
- **분기 커버리지**: 100%  
- **MC/DC**: 해당 없음 (DAL-D)

---

## 6. 소프트웨어 형상관리 계획 (SCMP)

### 6.1 형상관리 목표
- 생명주기 전체 변경사항 **추적**  
- **베이스라인 관리** 및 **버전 제어**  
- **변경 요청/승인** 프로세스 관리

### 6.2 형상 식별
- 소스 코드 파일  
- 실행 파일  
- 문서화 자료  
- 테스트 케이스 및 결과

### 6.3 변경 관리
**변경 요청 프로세스**
1. 변경 요청서 작성  
2. 기술 검토  
3. 영향 분석  
4. 승인/거부 결정  
5. 구현 및 검증  
6. 형상 업데이트

---

## 7. 추적성 매트릭스
| 요구사항 ID | 설계 요소        | 코드 구현                 | 테스트 케이스          |
|-------------|------------------|---------------------------|------------------------|
| HLR-001     | File_Validator   | `fread()`, 헤더 검증       | TC-001, TC-002, TC-003 |
| HLR-002     | Color_Converter  | `rgbToGrayscale()`        | TC-001                 |
| HLR-003     | Output_Generator | BMP 생성 루틴             | TC-001                 |
| HLR-004     | Memory_Manager   | `malloc()`, `free()`      | TC-004                 |
| HLR-005     | Error_Handler    | 오류 처리 루틴            | TC-002~TC-005          |
| HLR-006     | MEM_Exporter     | **MEM 생성 루틴**         | **TC-006, TC-007**     |

---

## 8. 인증 결론
본 BMP 그레이스케일 변환 소프트웨어는 DO-178C **DAL-D** 수준의 요구사항을 충족하도록 설계/구현되었으며, **v1.1 개정**을 통해 **베릴로그 시뮬레이션을 위한 MEM 출력 기능**이 추가되었습니다.  
모든 필수 문서가 작성되었고, 계획된 검증(특히 **TC-006/007**)을 통해 **안전성 및 출력 재현성**이 입증되었습니다.

**승인**
- 개발팀장: ________________  
- 품질보증 관리자: ________________  
- 인증 담당자: ________________  
- 날짜: **2025년 8월 29일**
